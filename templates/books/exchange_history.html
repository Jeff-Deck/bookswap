{% extends 'products/base.html' %}
{% block title %}Historial de Intercambios{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-10 px-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">üìñ Mi Historial de Intercambios</h1>

    {% if history %}
        <ul class="space-y-4">
            {% for record in history %}
                <li class="bg-white p-4 rounded shadow">
                    <p class="text-gray-800">
                        Libro solicitado: <strong>{{ record.book.title }}</strong><br>
                        {% if record.offered_book %}
                            Libro ofrecido: <strong>{{ record.offered_book.title }}</strong> ({{ record.offered_book.condition }}, {{ record.offered_book.genre }})<br>
                        {% endif %}

                        Intercambiado con:
                        {% if record.sender == user %}
                            <a href="{% url 'ver_perfil' record.receiver.id %}" class="text-blue-600 hover:underline">
                                <strong>{{ record.receiver }}</strong>
                            </a> (t√∫ lo enviaste)
                        {% else %}
                            <a href="{% url 'ver_perfil' record.sender.id %}" class="text-blue-600 hover:underline">
                                <strong>{{ record.sender }}</strong>
                            </a> (t√∫ lo recibiste)
                        {% endif %}

                        <br>
                        {% if record.can_rate %}
                            <a href="{% url 'rate_exchange' record.id %}" class="text-blue-600 hover:underline">‚≠ê Calificar a tu contraparte</a>
                        {% else %}
                            <p class="text-green-600">‚úÖ Ya calificaste este intercambio</p>
                        {% endif %}
                    </p>
                    <p class="text-gray-500 text-sm">
                        Fecha: {{ record.exchanged_on|date:"d M Y H:i" }}
                    </p>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="text-gray-600">A√∫n no has realizado intercambios.</p>
    {% endif %}
</div>
{% endblock %}
